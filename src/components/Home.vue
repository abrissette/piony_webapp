<template>
  <div class="wrapper home">
    <b-container class="mb-4">
        <b-row>
            <b-col sm="8" class="mb-3">
                <div>
                  <b-input-group>
                    <b-form-input placeholder="Search by patient ID"></b-form-input>
                    <b-input-group-append>
                      <b-btn variant="primary">Search</b-btn>
                    </b-input-group-append>
                  </b-input-group>
                </div>
            </b-col>
            <b-col sm="4" class="text-sm-right text-center">
                    <b-button btn-lg btn-block v-on:click="showNewPatientModal()" variant="primary">New Patient
                    </b-button>
                    <b-modal hide-footer ref="newPatientModal">
                        <NewPatient/>
                    </b-modal>
            </b-col>
        </b-row>
    </b-container>
    <b-container class=".patient-list-container">
        <h3 class="text-center">Patient List:</h3>
        <b-list-group>
            <b-list-group-item button v-for="(patient, index) in patients" v-bind:key="patient.id" v-on:click="showPatientInformation(index)">
                {{ patient.id }} {{ patient.firstName }} {{ patient.lastName}}
            </b-list-group-item>
            <b-modal hide-footer ref="patientInfoModal">
                <PatientInfo/>
            </b-modal>
        </b-list-group>
    </b-container>
  </b-container>
  </div>
</template>

<script>
import Vue from 'vue'
import { mapState } from 'vuex'
import { mapGetters} from 'vuex'
import NewPatient from './NewPatient.vue'
import PatientInfo from './PatientInfo.vue'
import PionyAPI from '../api/Piony.js'

export default Vue.extend({
    name: 'Home',
    data() {
        return {
            msg: 'blablbla',
        }

    },
    computed: {
        ...mapState({
            patients: 'patients',
            activePatient: 'activePatient',
        }),
    },
    components: {
        NewPatient,
        PatientInfo,
    },
    methods: {
        loadPatientList() {
            PionyAPI.getPatients().then((patients) => {
                this.$store.commit('setPatients', {patients: patients})
            })
        },
        showNewPatientModal() {
            this.$refs.newPatientModal.show();
        },
        showPatientInformation(index) {
            this.$store.commit('setActivePatient', {index: index});
            var promise = PionyAPI.getPatientRiskInfo(this.activePatient.postalCode);
            promise.then((risk) => {
                this.$store.commit('setActivePatientRisk', {risk: risk});
            })
            this.$refs.patientInfoModal.show();
        }
    },
    mounted() {
        this.loadPatientList();
    }
})
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style>
.testing-class {
    background-color: pink;
    border:1px solid black;
}

.patient-list-container {
    max-height: 700px;
    overflow-y: auto;
}

</style>
